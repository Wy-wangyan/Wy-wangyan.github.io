---
layout: post
title: 当移动区块链遇到边缘计算
tags: [MEC,Blockchain,Game Theory,IoT]
image: '/images/posts/7.jpg'
---

 
 <hr>
 
## Introduction
  区块链是一个可以存储数据和记录交易的去中心化的公共账本。它突破了中心化账本低效率的瓶颈，能够有效避免安全攻击和道德风险。数据被区块链以区块的形式存储，形成了一个链式的数据结构。没有中心化的实体和中间体来维持整个数据区块，相反，数据会被拷贝并且在整个区块链网络里面共享，来避免系统的崩溃，数据操纵和攻击。区块链已经应用到一些场景，比喻内容分发网络和智能网格系统。
   保证区块链的数据完整性和有效性的一个关键计算过程就是挖矿。想要形成一个新的区块到现有的区块链，一个矿工必须要解决一个计算密集的PoW(proof of work)问题,来获得一个哈希值，这个哈希值能够和上一个区块对应，从而连接上一个区块和当前区块。在解决PoW问题之后，问题的答案会广播到区块链网络当中的其他矿工，让他们来验证有效性。如果大多数的矿工都达到共识，新的区块才会被添加到区块链上。许多的共识协议都会给第一个成功解决PoW问题的矿工一个奖励(比如比特币)。但是解决PoW需要耗费大量的计算资源，一些计算能力有限的节点，比如物联网中的一些设备或者移动设备，很难直接参与到挖矿中，这就让区块链技术应用到物联网和其他移动服务上很困难。
    移动边缘计算(MEC)给移动环境带来了很大的算力资源。本地的数据中心和服务器被服务运营商部署到了移动网络的“边缘”，比如无线接入网络的基站。MEC是5G网络能够达到低延迟要求的一个关键技术。移动设备能够接入边缘服务器来增强自己的计算能力，所以边缘计算已经成为移动区块链应用的一个十分有潜力的解决方案了。首先，能够把更多的矿工集合起来，整个区块链网络的鲁棒性就得到了很大的提升，而且移动用户也能更多的从共识机制中获得了奖励。但是边缘计算服务是被运营商部署的，运营商的目的是最大化他的收益，因此边缘服务的定价问题也产生了。在考虑到边缘计算服务提供商提供的价格的基础上名矿工也需要最优化他们边缘计算服务的要求来解决PoW问题，来最大化他们自己的收益。

## Blockchain Overview

这里介绍一下区块链的基本的一些概念。区块链是一个链式的数据结构，每个数据区块都包含了被验证过的数据或者交易记录。在一个公共接入的区块链，区块链的数据可以被复制并且被传递至所有的用户。

### Blockchain Architecture

区块链中的每个区块包含两个部分，交易数据和hash值。交易数据被区块链用户或者系统(比如移动设备)记录，哈希值是用来存储加密后的信息的。一个区块的哈希值是基于它存储的信息和前一个区块而生成的，有一点类似当前区块指向它之前的一个区块的指针。区块链的第一个区块叫创世区块(genesis block)。
区块链的一个基本实现步骤：

1. 一个区块链用户进行了一次交易，并且创建了一个新的交易记录。新的交易将会传播到区块链网络的相邻的同等的用户处。(区块链网络就仅仅依靠各自平等的结点组成。)

2. 每个同等的用户收集到转移过来的一个指定时间段的交易记录。无效的用户交易，比如虚假交易，都会被丢掉。在这个时间段过后，收集了一组交易记录的用户会将交易记录打包进一个区块，并执行挖矿(解决PoW问题)，这类用户就是指矿工。

3. 已经被挖矿的区块会被送入网络中，告诉其他用户。其他的用户收到被挖矿的区块之后，会通过安全机制验证它的有效性，如果绝大多数用户都认证通过，那个被打包的区块就会被添加到区块链上，这就是共识的过程。

### Consensus and Mining:A Trust Overlay on a Trustless Network

*分布式共识*：区块链提供的不仅仅是在无信任的分布式网络中为交易和数据提供加密.加密技术被应用在挖矿中来保护区块链不被恶意修改，删除。共识机制确保网络中的信任，也就是说网络中的用户都能够在新区块添加到区块链的问题达到一个共识。所有用户可以通过检验区块链来发现是否被攻击者恶意注入了虚假的交易信息，大多数用户可以投票来剔除虚假的交易信息。共识机制对于独立用户的分布式计算系统十分有效。
*Proof-of-work based mining*：但是共识可能有些时候还是容易收到攻击者的攻击。比如Sybil攻击，攻击者创建虚假的区块链信息，然后通过虚假的用户将共识引导向错误的交易信息。这种攻击的应对方案就是提高挖矿的复杂度，这样攻击者就不会有足够的算力来创建更多的虚假用户了。PoW本身就是用来提高挖矿难度的。这是一个解决起来比较麻烦，但是验证十分容易的过程，解决PoW问题必须计算出一个值，并能够让哈希值的前几位低于一个给定的目标复杂度。确认交易数据的完整性和有效性是由多个矿工完成的。在许多的区块链系统中，比如比特币，一个成功挖矿的矿工在区块被添加到链上之后就会获得挖矿奖励。在区块链网络中，挖矿付出的代价是比较大的，攻击者要控制整个网络51%的算力资源才可以操纵区块链的，这个对于攻击者来说很难实现，所以实际中很难实现。

## Edge Computing Services for Mobile Blockchain

### Beyond Bitcoin: Edge Computing Services for Mobile Blockchain

区块链已经在很多网络或者分布式系统中应用，比如物联网。物联网系统连接了移动设备，传感器，或者一些其他的联网设备。物联网设备可以感应，通信，交换信息，最终应用到智能交通，物流，医疗，制造业。但是通常物联网设备都是低功耗，几何式分布，还有可能是移动的。算力资源和能源供应是应用区块链技术的巨大阻碍，但是移动边缘计算能够让服务运营商将云计算服务部署到移动网络的边缘。比如配有由小型的数据中心的基站在无线接入网络中可以获得通过卸载工作，执行邻近的移动设备或者物联网设备的计算服务。通过提供本地算力，边缘计算使得区块链在物联网中的部署能够解决PoW问题，哈希加密算法。
    边缘计算服务供应商和物联网设备及用户可以被看做成是市场活动，供应商出售资源，比如数据和计算能力，给物联网用户创造收益。实际上这种类似的整合了云和区块链的概念已经早就被发现，比如微软在Azure云平台提供的Blockchain as a Service（BaaS），一个英国公司CloudHashing提供的Bitcoin Mining as a Service（Maas），这些平台，用户只需要网上购买软件服务就能够挖比特币，不需要安装硬件设备。IBM提供的Watson IoT平台能够在一个私人的区块链账本管理物联网数据，这被归类在IBM的商用云服务。

### Open Issues

尽管区块链已经有了很广泛的应用，还是由一些公开的问题存在。

*安全*：虽然区块链有分布式的数据处理和存储，并以安全著称，但是应用到边缘计算还是有一些安全方面的问题需要解决，尤其是私人的区块链。比如在小范围的“白名单”物联网网络中，所有的网络节点都相互信任，PoW机制也就不存在，在这种情况下，将以数据由移动设备或者物联网设备传递到边缘计算服务器的过程中可能会受到攻击。需要设备和服务器之间安全又被信任的网络。DDoS攻击就可以轻易地打断移动区块链的连接和操作。因为移动设备和物联网设备依靠无线网络传输，jamming攻击可以扰乱区块链的数据交换。最后，有PoW的情况下，移动区块链51%攻击成为可能，因为物联网设备有有限的计算能力，可能不会以来外部的计算服务。

*资源利用和分配*：边缘计算服务也会有有限的能力，有可能不够支持所有用户的要iu。边缘计算资源分配的问题也就产生了。一方面，用户对于边缘计算服务的估价不同，估价取决于移动区块链中，一个区块的奖励和交易的数量，这些因素影响用户要求的计算资源。计算要求应该来最大化用户的利用率。另一方面，用户可以竞争供应商提供的边缘计算服务。因此，供应商可以通过调整价格来最大化收益，比如当边缘计算资源需求很高的时候，价格可以提升。一个经济模型就成了资源分配的解决方案。

## Prototype of Edge Computing for Mobile Blockchain
为了证明边缘计算应用区块链的可行性，我们实现一个规范的系统，在移动区块链网络节点，实现挖矿。这些节点就是矿工，安装移动区块链的客户端应用，应用可以通过加速度计和GPS记录数据，或者通过p2p传输交易数据。 
  我们首先用Node.js创建1000个区块，并用移动设备开始挖矿。我们考虑两种情况，三个矿工和四个矿工。三个矿工的情况，我们首先固定边缘计算服务要求(CPU利用率)，两个矿工分别是40和60，另一个是变化的。在四个矿工的情况下，固定三个矿工的利用率分别是40，50，60。每个被挖矿的区块的交易数量是10，每个区块的大小是一样的。我们可以通过调整挖矿难度(difficulty target in solving the PoW)来改变整个实验的时间,实验结果是，当边缘计算服务的要求提升，一个矿工成功挖矿的概率会提升。
  

## Edge Computing Resource Management for Mobile Blockchain

### Mobile Edge Computing for Blockchain Mining

移动区块链网络由$N$个用户充当矿工的角色。每个用户使用区块链应用记录交易数据，一个边缘计算运营商为矿工部署边缘计算服务器。PoW问题可以被卸载到边缘计算服务器上执行。运营商会给矿工定价。我们考虑的是一个相对较小的区块链网络，无线接入的通信延迟忽略不计。卸载挖矿过程被一些安全方法加密，比如data masking或者obfuscation。

运营商收取矿工的费用，矿工接入并且消耗边缘计算服务，同样接入边缘计算服务也会消耗矿工的能量，但是这肯定比矿工自己解决PoW问题少的多。每个矿工根据目前的区块链来决定自己的服务需求，这里的需求可是是CPU运行速度，也可以是要用多少个CPU核。运营商接受要求，边缘计算服务服务器替矿工解决PoW问题。我们可以认为边缘计算服务要求就是买来的算力。

在移动区块链网络中，矿工相互竞争，为了能够第一个解决PoW。一旦成功解决，这个矿工就会将他的答案广播到区块链网络中的其他用户，以达到共识。第一个成功解决的矿工可以得到奖励，这种奖励是从区块链应用中获得的。这种奖励被表示成一个多功能的函数，由$x_i$的边缘计算要求的第$i$个矿工由两个方面组成：(1)当一个区块被成功挖矿，获得的奖励，奖励包含两部分，固定的和浮动的部分；(2)解决PoW所花费的代价，也就是矿工$i$向边缘计算运营商付的单位价格$p_i$。

### Two-Stage Stackelberg Game Formulation and Equilibrium
可以用博弈论的观点来分析运营商和矿工的关系。可以表示成一个Stackelberg game的模型。运营商，也就是leader of the game，首先在Stage 1规定了每个计算单元的价格，矿工也就是followers，之后在Stage 2根据卸载挖矿任务决定最优计算服务要求，这是在知道了运营商提供的价格的基础上的。通过使用向后归纳，我们把leader和followers的最优化问题规范成两个子问题：

- Sub-game(Stage 2的矿工挖矿策略)：每个矿工$i$决定挖矿要求来最大化期望的利用率，在所有其他的矿工的需求和边缘计算服务价格已知的情况下。

- Sub-game(Stage 1运营商的价格策略)：运营商的纯利润是通过向矿工收费减去成本得到的。服务成本是服务需求的函数。

两步形成了Stackelberg game。博弈的目标是找到Stackelberg平衡，Stackelberg平衡确保了服务价格最大化利润，同时所有矿工也能够最大化他们的利用率。

对于运营商的定价，采用均匀和区别对待的价格策略。均匀定价策略，所有的矿工都收取相同的费用。区别对待的价格策略，运营商会向每个矿工收取不同的费用，均匀定价更容易实现，应为运营商不用把所有矿工的信息都记录，但是会导致利益不是最大。要获得最大的利益还是需要对于每个不同矿工进行专门收费。















